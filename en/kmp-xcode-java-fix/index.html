<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="If you’ve been working with Kotlin Multiplatform for a while, chances are you have more than one Java SDK installed on your machine. Android development, Spring Framework, CLI tooling – they don’t all agree on which Java version they want, and managing that is just part of the job." />
    <meta name="author" content="Igor Ferreira" />
    <meta name="generator" content="Ignite v0.6.0" />
    <title>Kotlin Multiplatform: Fixing Java Version Conflicts in the Xcode Build Phase</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/css/prism-github-dark.css" rel="stylesheet" data-highlight-theme="github-dark" />
    <link href="/css/prism-plugins.css" rel="stylesheet" />
    <link href="/css/bootstrap-icons.min.css" rel="stylesheet" />
    <link href="/css/ignite-core.min.css" rel="stylesheet" />
    <link href="https://igorcferreira.dev/en/kmp-xcode-java-fix" rel="canonical" />
    <meta property="og:site_name" content="Development Blog" />
    <meta property="og:title" content="Kotlin Multiplatform: Fixing Java Version Conflicts in the Xcode Build Phase" />
    <meta name="twitter:title" content="Kotlin Multiplatform: Fixing Java Version Conflicts in the Xcode Build Phase" />
    <meta property="og:description" content="If you’ve been working with Kotlin Multiplatform for a while, chances are you have more than one Java SDK installed on your machine. Android development, Spring Framework, CLI tooling – they don’t all agree on which Java version they want, and managing that is just part of the job." />
    <meta name="twitter:description" content="If you’ve been working with Kotlin Multiplatform for a while, chances are you have more than one Java SDK installed on your machine. Android development, Spring Framework, CLI tooling – they don’t all agree on which Java version they want, and managing that is just part of the job." />
    <meta property="og:url" content="https://igorcferreira.dev/en/kmp-xcode-java-fix" />
    <meta name="twitter:domain" content="igorcferreira.dev" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:dnt" content="on" />
    <link href="/apple-touch-icon-precomposed.png" rel="apple-touch-icon" />
    <link href="https://mastodon.social/@igorcferreira" rel="me" />
    <meta name="apple-mobile-web-app-title" content="Development Blog" />
    <meta name="fediverse:creator" content="@igorcferreira@mastodon.social" />
  </head>
  <body class="container">
    <header>
      <nav class="navbar navbar-expand-md" style="background-color: rgb(220 53 69 / 100%)" data-bs-theme="dark">
        <div class="container flex-wrap flex-lg-nowrap">
          <button type="button" class="navbar-toggler btn" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
          <div id="navbarCollapse" class="collapse navbar-collapse">
            <ul class="navbar-nav mb-2 mb-md-0 col ">
              <li class="nav-item"><a href="/en/home" class="nav-link text-nowrap">Home</a></li>
              <li class="nav-item"><a href="/en/categories" class="nav-link text-nowrap">Categories</a></li>
              <li class="nav-item"><a href="/en/resume" class="nav-link text-nowrap">Resume</a></li>
              <li class="nav-item"><a target="_blank" href="https://github.com/igorcferreira" class="nav-link text-nowrap">GitHub</a></li>
              <li class="nav-item"><a target="_blank" href="https://mastodon.social/@igorcferreira" class="nav-link text-nowrap">Mastodon</a></li>
              <li class="nav-item"><a target="_blank" href="/feed.rss" class="nav-link text-nowrap">Feed</a></li>
              <div class="ms-auto"></div>
              <li class="nav-item"><a href="/pt/kmp-xcode-java-fix" class="nav-link text-nowrap">Ver em Português</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    <div class="ig-main-content">
      <h1>Kotlin Multiplatform: Fixing Java Version Conflicts in the Xcode Build Phase</h1>
      <p>Tagged with: iOS, SwiftUI, KMP, Kotlin</p>
      <p>444 words; 2 minutes to read</p>
      <p></p>
      <p>If you’ve been working with Kotlin Multiplatform for a while, chances are you have more than one Java SDK installed on your machine. Android development, Spring Framework, CLI tooling – they don’t all agree on which Java version they want, and managing that is just part of the job.</p>
      <p>Most of the time, your shell profile handles it gracefully. But there’s one place where that setup quietly breaks down: the Xcode Build Phase.</p>
      <h2>Why Xcode doesn’t see your Java config</h2>
      <p>When the KMP project template sets up the iOS target, it adds a Build Phase script that calls <code>embedAndSignAppleFrameworkForXcode</code> on your shared Gradle project. The catch is that Xcode runs this script in its own isolated bash environment, one that doesn’t source your <code>.zshrc</code>, <code>.bash_profile</code>, or wherever you’ve configured your Java toolchain. So instead of picking up the version you intended, Gradle grabs whatever Java sits at the top of the system path. If that happens to be Java 25 and your project targets Java 21, the build fails.</p>
      <h2>The fix</h2>
      <p>Before the fix, the default Build Phase script looks like this:</p>
      <pre><code class="language-shell">if [ "YES" = "$OVERRIDE_KOTLIN_BUILD_IDE_SUPPORTED" ]; then
  echo "Skipping Gradle build task invocation due to OVERRIDE_KOTLIN_BUILD_IDE_SUPPORTED environment variable set to \"YES\""
  exit 0
fi
cd "$SRCROOT/.."
./gradlew :shared:embedAndSignAppleFrameworkForXcode
</code></pre>
      <p>The solution is to set <code>JAVA_HOME</code> inline, scoped to just that Gradle invocation, using macOS’s built-in <code>java_home</code> utility:</p>
      <pre><code class="language-shell">if [ "YES" = "$OVERRIDE_KOTLIN_BUILD_IDE_SUPPORTED" ]; then
  echo "Skipping Gradle build task invocation due to OVERRIDE_KOTLIN_BUILD_IDE_SUPPORTED environment variable set to \"YES\""
  exit 0
fi
cd "$SRCROOT/.."
JAVA_HOME="$(/usr/libexec/java_home -v21)" ./gradlew :shared:embedAndSignAppleFrameworkForXcode
</code></pre>
      <p>The <code>/usr/libexec/java_home -v21</code> command resolves the full path to your Java 21 installation. Setting it inline means it only affects that single command, so nothing bleeds into the rest of the build environment.</p>
      <p>Adjust the version flag to match whatever your project requires. If you’re unsure which versions you have available, running <code>/usr/libexec/java_home -V</code> (capital V) will list them all.</p>
      <h2>Worth keeping in mind</h2>
      <p>This is a template file, which means it gets regenerated if you ever re-run the KMP project setup. It’s worth keeping a note of this change somewhere in your project – a comment in the script itself works fine – so it doesn’t catch you off guard after an update.</p>
      <hr />
      <p>Short, boring, and hopefully useful to someone hitting the same wall.</p>
      <p></p>
    </div>
    <p class="text-center mt-5">Created in Swift with <a href="https://github.com/twostraws/Ignite">Ignite</a></p>
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/syntax-highlighting.js"></script>
    <script src="/js/ignite-core.js"></script>
  </body>
</html>